<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>MÃ¤usegruppe Terminal</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAQaNKUa-RKvUcwlPpWnEyKxcVjYV6cZuU",
      authDomain: "gesamt-dae4e.firebaseapp.com",
      databaseURL: "https://gesamt-dae4e-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gesamt-dae4e",
      storageBucket: "gesamt-dae4e.appspot.com",
      messagingSenderId: "844023612743",
      appId: "1:844023612743:web:0821aa894541f89a7df862"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const main = document.getElementById("main");

    function showStart() {
      main.innerHTML = `
        <h1>MÃ¤usegruppe Terminal</h1>
        <button onclick="showAusleihe()">ðŸŽ’ Spielzeug Ausleihe</button>
        <button onclick="showCheckout()">ðŸ“¤ Checkout</button>
      `;
    }

    window.showAusleihe = () => {
      main.innerHTML = "<h2>Spielzeug Ausleihe</h2>";
      const container = document.createElement("div");
      main.appendChild(container);

      onValue(ref(db, "kinder"), snapshot => {
        container.innerHTML = "";
        snapshot.forEach(child => {
          const name = child.key;
          const btn = document.createElement("button");
          btn.textContent = name;
          btn.onclick = () => openAusleihe(name);
          container.appendChild(btn);
        });
      });
    };

    async function openAusleihe(name) {
      const ausleiheSnap = await get(ref(db, "ausleihen/" + name));
      if (ausleiheSnap.exists()) {
        alert("Bitte gib dein aktuelles Spielzeug zurÃ¼ck, bevor du ein neues ausleihst.");
        return;
      }

      const spielzeugeSnap = await get(ref(db, "spielzeuge"));
      const spielzeuge = spielzeugeSnap.exists() ? spielzeugeSnap.val() : {};
      const nummer = prompt("Gib die Spielzeugnummer ein:");

      if (nummer && spielzeuge[nummer]) {
        await set(ref(db, "ausleihen/" + name), {
          spielzeug: spielzeuge[nummer],
          nummer: nummer,
          zeit: new Date().toISOString(),
          bestÃ¤tigt: false
        });
        alert(`${spielzeuge[nummer]} wurde erfolgreich ausgeliehen.`);
      } else {
        alert("UngÃ¼ltige Nummer.");
      }
    }

    window.showCheckout = () => {
      main.innerHTML = "<h2>Checkout</h2>";
      const container = document.createElement("div");
      main.appendChild(container);

      onValue(ref(db, "kinder"), snapshot => {
        container.innerHTML = "";
        snapshot.forEach(child => {
          const name = child.key;
          const data = child.val();
          const link = data.checkoutLink || "#";
          const btn = document.createElement("button");
          btn.textContent = name;
          btn.onclick = () => window.location.href = link;
          container.appendChild(btn);
        });
      });
    };

    showStart();
  </script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h1, h2 {
      margin-bottom: 20px;
    }
    button {
      display: block;
      margin: 10px 0;
      padding: 12px 20px;
      font-size: 16px;
      width: 100%;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <div id="main"></div>
</body>
</html>