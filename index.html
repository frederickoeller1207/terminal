<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Mäusegruppe Terminal</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAQaNKUa-RKvUcwlPpWnEyKxcVjYV6cZuU",
      authDomain: "gesamt-dae4e.firebaseapp.com",
      databaseURL: "https://gesamt-dae4e-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gesamt-dae4e",
      storageBucket: "gesamt-dae4e.appspot.com",
      messagingSenderId: "844023612743",
      appId: "1:844023612743:web:0821aa894541f89a7df862"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const terminal = document.getElementById("terminal");
    const overlay = document.getElementById("overlay");

    onValue(ref(db, "kinder"), (snapshot) => {
      terminal.innerHTML = "";
      snapshot.forEach(childSnapshot => {
        const name = childSnapshot.key;
        const btn = document.createElement("button");
        btn.textContent = name;
        btn.onclick = () => ausleihen(name);
        terminal.appendChild(btn);
      });
    });

    async function ausleihen(name) {
      const ausleiheRef = ref(db, `ausleihen/${name}`);
      const vorhanden = await get(ausleiheRef);
      if (vorhanden.exists() && vorhanden.val().bestätigt !== true) {
        showMessage("Bitte gib das ausgeliehene Spielzeug zuerst zurück.");
        return;
      }

      const spielzeugeSnap = await get(ref(db, "spielzeuge"));
      const spielzeuge = spielzeugeSnap.exists() ? spielzeugeSnap.val() : {};
      const nummer = prompt("Gib die Spielzeugnummer ein:");
      if (!nummer || !spielzeuge[nummer]) {
        showMessage("Ungültige Nummer.");
        return;
      }

      await set(ausleiheRef, {
        spielzeug: spielzeuge[nummer],
        nummer: nummer,
        zeit: new Date().toISOString(),
        bestätigt: false
      });

      showMessage(`${spielzeuge[nummer]} wurde erfolgreich ausgeliehen.`);
    }

    function showMessage(text) {
      overlay.textContent = text;
      overlay.style.display = "block";
      setTimeout(() => {
        overlay.style.display = "none";
      }, 3000);
    }
  </script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h1 {
      margin-bottom: 20px;
    }
    button {
      display: block;
      margin: 8px 0;
      padding: 12px 20px;
      font-size: 18px;
      width: 100%;
      max-width: 300px;
    }
    #overlay {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #222;
      color: #fff;
      padding: 15px 25px;
      border-radius: 10px;
      display: none;
      font-size: 16px;
      z-index: 9999;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }
  </style>
</head>
<body>
  <h1>Mäusegruppe Terminal</h1>
  <div id="terminal"></div>
  <div id="overlay"></div>
</body>
</html>