<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Mäusegruppe Admin</title>
  <style>
    body { font-family: sans-serif; padding: 1em; background: #f9f9f9; }
    h1 { font-size: 1.5em; }
    .block { margin-bottom: 2em; }
    input, button { margin: 0.3em 0; padding: 0.5em; }
    .item { background: #fff; border: 1px solid #ccc; margin: 0.3em 0; padding: 0.5em; }
  </style>
</head>
<body>
  <h1>Mäusegruppe Admin</h1>

  <div class="block">
    <h2>Neues Kind hinzufügen</h2>
    <input type="text" id="kindName" placeholder="Name">
    <button onclick="addKind()">Hinzufügen</button>
  </div>

  <div class="block">
    <h2>Neues Spielzeug hinzufügen</h2>
    <input type="text" id="spielzeugNr" placeholder="Nummer (z. B. 001)">
    <input type="text" id="spielzeugName" placeholder="Bezeichnung (z. B. Springseil)">
    <button onclick="addToy()">Hinzufügen</button>
  </div>

  <div class="block">
    <h2>Aktuelle Ausleihen</h2>
    <div id="ausleihen"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, remove, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://gesamt-dae4e-default-rtdb.europe-west1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.addKind = () => {
      const name = document.getElementById('kindName').value.trim();
      if (!name) return alert("Name eingeben!");
      set(ref(db, 'kinder/' + name), { ausgeliehen: false });
      document.getElementById('kindName').value = "";
    };

    window.addToy = () => {
      const nr = document.getElementById('spielzeugNr').value.trim();
      const name = document.getElementById('spielzeugName').value.trim();
      if (!nr || !name) return alert("Beides eingeben!");
      set(ref(db, 'spielzeuge/' + nr), name);
      document.getElementById('spielzeugNr').value = "";
      document.getElementById('spielzeugName').value = "";
    };

    window.zurueckgeben = (name) => {
      remove(ref(db, "kinder/" + name + "/ausgeliehen"));
    };

    const el = document.getElementById("ausleihen");
    const kinderRef = ref(db, "kinder");

    onValue(kinderRef, snapshot => {
      el.innerHTML = "";
      snapshot.forEach(child => {
        const name = child.key;
        const data = child.val();
        if (data.ausgeliehen) {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `<b>${name}</b> hat <i>${data.ausgeliehen}</i> ausgeliehen 
            <button onclick="zurueckgeben('${name}')">Zurückgeben</button>`;
          el.appendChild(div);
        }
      });
    });
  </script>
</body>
</html>
