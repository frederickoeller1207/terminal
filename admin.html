<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ MÃ¤usegruppe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color:#007aff; --primary-hover-color:#005bb5;
      --background-color:#f4f4f4; --card-background-color:#fff;
      --text-color:#333; --border-radius:12px; --box-shadow:0 4px 10px rgba(0,0,0,.08);
      --font-size-small:14px; --font-size-medium:16px;
    }
    body{font-family:'SF Pro Display',sans-serif;padding:15px;background:var(--background-color);color:var(--text-color);font-size:var(--font-size-medium);line-height:1.6}
    h2{font-size:18px;margin:0 0 15px;font-weight:600}
    input[type="text"],input[type="number"]{padding:8px;border:1px solid #ddd;border-radius:8px;font-size:var(--font-size-small);width:100%;box-sizing:border-box}
    button{padding:8px 14px;font-size:var(--font-size-small);background:var(--primary-color);color:#fff;border:none;border-radius:10px;cursor:pointer;transition:background-color .2s;font-weight:600;white-space:nowrap}
    button.secondary{background:#f0f0f0;color:#333;border:1px solid #ccc}
    button.secondary:hover{background:#e0e0e0}
    button:hover{background:var(--primary-hover-color)}
    .section{background:var(--card-background-color);padding:15px;margin-bottom:20px;border-radius:var(--border-radius);box-shadow:var(--box-shadow)}
    .liste{margin-top:15px;padding-top:15px;border-top:1px solid #eee}
    .liste>div{padding:10px 0;border-bottom:1px solid #f9f9f9;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
    .liste>div:last-child{border-bottom:none}
    .delete{color:#ff3b30;cursor:pointer;margin-left:10px;font-weight:600;font-size:var(--font-size-small)}
    .delete:hover{text-decoration:underline}
    .flex{display:flex;align-items:center;gap:10px;padding:8px 0}
    .flex-buttons{display:flex;gap:5px;align-items:center}
    .color-button{border:1px solid #ccc;border-radius:5px;padding:2px 5px;font-size:16px;cursor:pointer;transition:all .2s;background:#fff}
    .color-button:hover{transform:scale(1.1);box-shadow:0 2px 4px rgba(0,0,0,.1)}
    .small-button{padding:4px 8px;font-size:12px;border-radius:8px;background:#fff;color:#333;border:1px solid #ccc}
    .shop-admin-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
    .action-buttons{display:flex;gap:5px;flex-grow:1;justify-content:flex-end}
    .action-button{padding:8px 12px;border-radius:8px;border:none;color:#fff;font-weight:600;cursor:pointer;transition:background-color .2s;white-space:nowrap}
    .action-button.execute{background:var(--primary-color)}
    .action-button.execute:hover{background:#005bb5}
    .action-button.white{background:#fff;color:#333;border:1px solid #ccc}
    .action-button.white:hover{background:#f0f0f0}
    .action-button.green{background:#28a745}
    .action-button.green:hover{background:#218838}
    .callout{background:#fff7ed;border:1px solid #fed7aa;border-radius:10px;padding:10px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row>*{flex:1 1 220px}
    select,input[type="datetime-local"]{padding:8px;border:1px solid #ddd;border-radius:8px;font-size:var(--font-size-small);width:100%;box-sizing:border-box}
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .mode-wrap{display:flex;align-items:center;gap:10px}
    .mode-cycle{display:inline-flex;align-items:center;gap:8px;background:#fff;border:1px solid #ccc;color:#111;border-radius:999px;padding:6px 10px}
    .mode-dot{width:12px;height:12px;border-radius:50%}
    .dot-green{background:#16a34a}.dot-yellow{background:#f59e0b}.dot-red{background:#ef4444}
    .mode-text{font-weight:700;font-size:14px}
    .title{font-size:22px;font-weight:600;color:var(--primary-color);margin-left:auto}
  </style>

  <script type="module">
    import { initializeApp as initApp1 } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getDatabase as getDB1, ref as ref1, set, onValue, get, push, remove } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";
    import { initializeApp as initApp2 } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getDatabase as getDB2, ref as ref2, get as get2, update as update2, onValue as onVal2, remove as remove2, set as set2 } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";
    import { initializeApp as initApp3 } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getDatabase as getDB3, ref as ref3, onValue as onVal3, update as update3, remove as remove3, get as get3 } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";

    const app1 = initApp1({
      apiKey:"AIzaSyAQaNKUa-RKvUcwlPpWnEyKxcVjYV6cZuU",
      authDomain:"gesamt-dae4e.firebaseapp.com",
      databaseURL:"https://gesamt-dae4e-default-rtdb.europe-west1.firebasedatabase.app",
      projectId:"gesamt-dae4e",
      storageBucket:"gesamt-dae4e.appspot.com",
      messagingSenderId:"844023612743",
      appId:"1:844023612743:web:0821aa894541f89a7df862"
    },"app1");
    const db1 = getDB1(app1);

    const app2 = initApp2({
      apiKey:"AIzaSyAdPN2duh89Fx5rmYlFshdf0juhYNX_7fg",
      authDomain:"punkte-45c20.firebaseapp.com",
      databaseURL:"https://punkte-45c20-default-rtdb.europe-west1.firebasedatabase.app",
      projectId:"punkte-45c20",
      storageBucket:"punkte-45c20.appspot.com",
      messagingSenderId:"931713539549",
      appId:"1:931713539549:web:e348bf38369639f1906a34"
    },"app2");
    const db2 = getDB2(app2);

    const app3 = initApp3({
      apiKey:"AIzaSyAdPN2duh89Fx5rmYlFshdf0juhYNX_7fg",
      databaseURL:"https://punkte-45c20-default-rtdb.europe-west1.firebasedatabase.app"
    },"app3");
    const db3 = getDB3(app3);

    /* ===== Systemmodus (grÃ¼n/gelb/rot) â€“ schreibt nach gesamt-dae4e/systemmode/state ===== */
    const modeRef = ref1(db1, "systemmode/state");
    const modeBtn = () => document.getElementById("mode-cycle");
    const modeDot = () => document.getElementById("mode-dot");
    const modeText = () => document.getElementById("mode-text");
    const order = ["green","yellow","red"];

    function nextMode(cur){ const i=order.indexOf(cur); return order[(i<0?0:(i+1)%order.length)]; }
    function labelFor(m){ if(m==="green")return"GrÃ¼n Â· Normal"; if(m==="yellow")return"Gelb Â· EingeschrÃ¤nkt"; return"Rot Â· Gesperrt"; }
    function dotClass(m){ if(m==="green")return"dot-green"; if(m==="yellow")return"dot-yellow"; return"dot-red"; }
    async function setMode(m){ await set(modeRef,{ value:m, updatedAt:Date.now() }); }
    function renderMode(m){ modeText().textContent=labelFor(m); modeDot().className="mode-dot "+dotClass(m); modeBtn().title="Modus wechseln"; }

    onValue(modeRef,snap=>{ const v=snap.exists()?(snap.val().value||"green"):"green"; renderMode(v); });
    window.addEventListener("DOMContentLoaded",()=>{
      modeBtn().addEventListener("click", async ()=>{
        const snap=await get(modeRef); const cur=snap.exists()?(snap.val().value||"green"):"green";
        await setMode(nextMode(cur));
      });
    });

    /* ===== Rest deines bestehenden Admin-Codes (unverÃ¤ndert) ===== */
    /* â€¦ ALLES ANDERE AUS DEINEM POST BLEIBT UNVERÃ„NDERT â€¦ */
    /* Ich habe nur Tippfehler in ladeHistorie korrigiert (eitrag -> eintrag). */

    /* Farben und Mappings */
    const farben=["âšª","ðŸ”´","ðŸŸ¡","ðŸŸ¢","âš«","ðŸŸ£"];
    function farbeToColor(f){ if(f==="ðŸ”´")return"red"; if(f==="ðŸŸ¡")return"orange"; if(f==="ðŸŸ¢")return"green"; if(f==="âš«")return"black"; if(f==="ðŸŸ£")return"purple"; return"#333";}
    function colorToDelta(f){ if(f==="ðŸŸ¢")return 5; if(f==="ðŸŸ£")return 10; if(f==="ðŸ”´")return -5; if(f==="âš«")return -10; return 0;}
    const clamp01=x=>Math.max(0,Math.min(100,x|0));

    /* â€¦ dein kompletter Rest-Code wie gepostet â€¦ */
  </script>
</head>
<body>
  <div class="topbar">
    <div class="mode-wrap">
      <button id="mode-cycle" class="mode-cycle" title="Modus wechseln">
        <span id="mode-dot" class="mode-dot dot-green"></span>
        <span id="mode-text" class="mode-text">GrÃ¼n Â· Normal</span>
      </button>
    </div>
    <div class="title">Adminbereich</div>
  </div>

  <!-- Dein unverÃ¤nderter Body-Inhalt wie gepostet -->
  <!-- â€¦ -->
</body>
</html>